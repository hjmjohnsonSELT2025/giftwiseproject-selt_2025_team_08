<%= form_with model: event, local: true, data: { controller: "event-form", "event-form-event-id-value": event.persisted? ? event.id : nil } do |f| %>
  <div class="field">
    <%= f.label :name, "Event Name" %><br>
    <%= f.text_field :name, required: true %>
  </div>

  <div class="field">
    <%= f.label :description %><br>
    <%= f.text_area :description, rows: 4 %>
  </div>

  <div class="field">
    <%= f.label :start_at, "Start date and time" %><br>
    <%= f.datetime_local_field :start_at, required: true %>
  </div>

  <div class="field">
    <%= f.label :end_at, "End date and time" %><br>
    <%= f.datetime_local_field :end_at, required: true %>
  </div>

  <div class="field">
    <%= f.label :location %><br>
    <%= f.text_field :location %>
  </div>

  <div class="field">
    <%= f.label :theme %><br>
    <%= f.select :theme, Event::THEMES, { prompt: "Select a theme" }, required: true %>
  </div>

  <div class="field">
    <h3>Attendees</h3>
    <ul id="attendees-list" data-event-form-target="attendeesList">
      <% if event.persisted? && event.attendees.any? %>
        <% event.attendees.each do |attendee| %>
          <li data-attendee-id="<%= attendee.id %>">
            <%= "#{attendee.first_name} #{attendee.last_name}" %>
            <button type="button" class="btn-small">Remove</button>
          </li>
        <% end %>
      <% end %>
    </ul>
    <p id="no-attendees" style="<%= event.persisted? && event.attendees.any? ? '"'"'display:none;'"'"' : '"'"''"'"' %>">No attendees added yet.</p>

    <%= text_field_tag :attendee_search, "", placeholder: "Type a contact name", id: "attendee-search", data: { "event-form-target": "attendeeSearch" } %>
    <button type="button" data-action="click->event-form#searchAttendees" class="btn-secondary">Search</button>
    <div id="attendee-search-results"></div>
  </div>

  <div class="field">
    <h3>Recipients</h3>
    <ul id="recipients-list" data-event-form-target="recipientsList">
      <% if event.persisted? && event.recipients.any? %>
        <% event.recipients.each do |recipient| %>
          <li data-recipient-id="<%= recipient.id %>">
            <%= "#{recipient.first_name} #{recipient.last_name}" %>
            <button type="button" class="btn-small">Remove</button>
          </li>
        <% end %>
      <% end %>
    </ul>
    <p id="no-recipients" style="<%= event.persisted? && event.recipients.any? ? '"'"'display:none;'"'"' : '"'"''"'"' %>">No recipients added yet.</p>

    <%= text_field_tag :contact_search, "", placeholder: "Type a contact name", id: "contact-search", data: { "event-form-target": "recipientSearch" } %>
    <button type="button" data-action="click->event-form#searchRecipients" class="btn-secondary">Search</button>
    <div id="contact-search-results"></div>
  </div>

  <div class="actions">
    <%= f.submit "Save Event" %>
  </div>
<% end %>
