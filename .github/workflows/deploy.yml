name: Deploy

on:
  push:
    branches: [ main, master ]
  workflow_dispatch: # Allows manual triggering

jobs:
  # Run tests before deploying
  test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: '3.3.8'
        bundler-cache: true
    
    - name: Create storage directory
      run: mkdir -p storage
    
    - name: Set up database
      env:
        RAILS_ENV: test
      run: |
        bundle exec rails db:prepare
    
    - name: Run tests
      env:
        RAILS_ENV: test
      run: bundle exec rspec

  # Build Docker image (optional - uncomment and configure if using Docker)
  # build-docker:
  #   runs-on: ubuntu-latest
  #   needs: test
  #   steps:
  #   - name: Checkout code
  #     uses: actions/checkout@v4
  #   
  #   - name: Set up Docker Buildx
  #     uses: docker/setup-buildx-action@v3
  #   
  #   - name: Login to Docker Hub (or your registry)
  #     uses: docker/login-action@v3
  #     with:
  #       username: ${{ secrets.DOCKER_USERNAME }}
  #       password: ${{ secrets.DOCKER_PASSWORD }}
  #   
  #   - name: Build and push Docker image
  #     uses: docker/build-push-action@v5
  #     with:
  #       context: .
  #       push: true
  #       tags: your-username/giftwise:latest

  # Deploy to production (example for Heroku, Railway, Render, etc.)
  # Uncomment and configure based on your hosting provider
  # deploy:
  #   runs-on: ubuntu-latest
  #   needs: test
  #   steps:
  #   - name: Checkout code
  #     uses: actions/checkout@v4
  #   
  #   # Example for Heroku:
  #   # - name: Deploy to Heroku
  #   #   uses: akhileshns/heroku-deploy@v3.12.12
  #   #   with:
  #   #     heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
  #   #     heroku_app_name: "your-app-name"
  #   #     heroku_email: "your-email@example.com"
  #   
  #   # Example for Railway:
  #   # - name: Deploy to Railway
  #   #   uses: bervProject/railway-deploy@v1.0.0
  #   #   with:
  #   #     railway_token: ${{ secrets.RAILWAY_TOKEN }}
  #   #     service: your-service-name
  #   
  #   # Example for Render:
  #   # - name: Deploy to Render
  #   #   run: |
  #   #     curl -X POST https://api.render.com/deploy/srv-xxxxx \
  #   #       -H "Authorization: Bearer ${{ secrets.RENDER_API_KEY }}"



